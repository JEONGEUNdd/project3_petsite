{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h1>ì±„íŒ…</h1>

    <div class="row">
        <!-- ğŸ“Œ ì±„íŒ… ëª©ë¡ (ì™¼ìª½) -->
        <div class="col-md-4">
            <hr>
            <h4>ì±„íŒ… ëª©ë¡</h4>
            <ul class="list-group1">
                {% if chat_rooms %}
                    {% for chat in chat_rooms %}
                    <li class="list-group-item1 {% if chat.chat_id == chat_id %}active{% endif %}">
                        <div class="d-flex flex-column">
                            <!-- ğŸ“Œ ê²Œì‹œê¸€ ì œëª© -->
                            <strong>
                                {% if chat.post_id and chat.post_id > 0 %}
                                    <span class="text-danger">ğŸ“Œ</span> 
                                    {% if chat.category == 'walks' %}
                                        <a href="{{ url_for('walk_detail', post_id=chat.post_id) }}" class="text-primary">
                                            {{ chat.post_title }}
                                        </a>
                                    {% elif chat.category == 'community_posts' %}
                                        <a href="{{ url_for('community_detail', post_id=chat.post_id) }}" class="text-primary">
                                            {{ chat.post_title }}
                                        </a>
                                    {% elif chat.category == 'petsitters' %}
                                        <a href="{{ url_for('petsitter_detail', post_id=chat.post_id) }}" class="text-primary">
                                            {{ chat.post_title }}
                                        </a>
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">(ê´€ë ¨ ê²Œì‹œê¸€ ì—†ìŒ)</span>
                                {% endif %}
                            </strong>
                            <!-- ğŸ“Œ ì±„íŒ… ìƒëŒ€ë°© -->
                            <!-- <a href="{{ url_for('chat_room', chat_id=chat.chat_id) }}" class="text-dark">
                                ğŸ’¬ {{ chat.chat_partner }}
                            </a>
                        </div> -->
                    </li>
                    {% endfor %}
                {% else %}
                    <li class="list-group-item text-muted">ì§„í–‰ ì¤‘ì¸ ì±„íŒ…ì´ ì—†ìŠµë‹ˆë‹¤.</li>
                {% endif %}
            </ul>
        </div>

        <!-- ğŸ“Œ ì±„íŒ… í™”ë©´ (ì˜¤ë¥¸ìª½) -->
        <div class="col-md-8">
            <!-- ğŸ“Œ ê´€ë ¨ ê²Œì‹œê¸€ ì •ë³´ (ì±„íŒ…ì°½ ìƒë‹¨) -->
            {% if post_info and post_info.post_id > 0 %}
            <div class="text-end mb-3">
                <span class="text-danger">ğŸ“Œ ê´€ë ¨ ê²Œì‹œê¸€: </span>
                <a href="
                    {% if post_info.category == 'walks' %}
                        {{ url_for('walk_detail', post_id=post_info.post_id) }}
                    {% elif post_info.category == 'community_posts' %}
                        {{ url_for('community_detail', post_id=post_info.post_id) }}
                    {% elif post_info.category == 'petsitters' %}
                        {{ url_for('petsitter_detail', post_id=post_info.post_id) }}
                    {% endif %}
                " class="text-primary fw-bold">
                    {{ post_info.post_title }}
                </a>
            </div>
            {% endif %}

            {% if chat_id %}
            <!-- ğŸ“Œ ì±„íŒ… ë©”ì‹œì§€ ì¶œë ¥ (ì´ˆë¡ìƒ‰ ìŠ¤íƒ€ì¼ ìœ ì§€) -->
            <div class="chat-box p-3 border rounded bg-light">
                {% for msg in messages %}
                <div class="chat-message {% if msg.sender_id == user_id %}my-message{% else %}their-message{% endif %}">
                    <p class="mb-1">{{ msg.message }}</p>
                    <div class="chat-meta text-muted small">
                        {{ msg.sender_name }} | {{ msg.created_at }}
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- ğŸ“Œ ë©”ì‹œì§€ ì…ë ¥ì°½ -->
            <form method="POST" action="{{ url_for('send_message', chat_id=chat_id) }}" class="d-flex mt-3">
                <input type="text" name="message" class="custom-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." required>
                <button type="submit" class="custom-btn">ì „ì†¡</button>
            </form>
            {% else %}
            <p class="text-muted">ì±„íŒ…ë°©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}